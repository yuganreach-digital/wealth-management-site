---
// Cookie Consent Banner Component
---

<div id="cookie-consent-banner" class="cookie-banner hidden fixed bottom-0 left-0 right-0 z-50">
  <div class="absolute inset-0 bg-gradient-to-t from-white/95 via-white/90 to-white/85 backdrop-blur-md"></div>
  <div class="relative max-w-7xl mx-auto px-4 py-6">
    <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
      <!-- Cookie Icon and Main Content -->
      <div class="flex items-start gap-4 flex-1">
        <div class="w-10 h-10 bg-gradient-to-br from-amber-400/20 to-amber-600/20 backdrop-blur-sm border border-amber-300/30 rounded-xl flex items-center justify-center flex-shrink-0 mt-1 shadow-lg">
          <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        
        <div class="flex-1">
          <h3 class="text-lg font-serif font-semibold text-slate-900 mb-2">We Use Cookies</h3>
          <p class="text-sm text-slate-600 leading-relaxed mb-3">
            We use essential cookies to make our site work. We'd also like to set analytics cookies to help us improve it. 
            <a href="/wealth-management-site/privacy" class="text-amber-600 hover:text-amber-700 underline">Learn more in our Privacy Policy</a>.
          </p>
          
          <!-- Cookie Preferences Details -->
          <div id="cookie-details" class="hidden mt-4 p-4 bg-white/60 backdrop-blur-sm border border-white/20 rounded-xl shadow-lg">
            <h4 class="font-serif font-semibold text-slate-900 mb-3">Cookie Preferences</h4>
            
            <!-- Essential Cookies -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <label class="text-sm font-medium text-slate-900">Essential Cookies</label>
                <div class="flex items-center">
                  <input type="checkbox" id="essential-cookies" checked disabled class="w-4 h-4 text-amber-600 bg-gray-100 border-gray-300 rounded focus:ring-amber-500">
                  <span class="ml-2 text-xs text-slate-500">Required</span>
                </div>
              </div>
              <p class="text-xs text-slate-600">These cookies are necessary for the website to function and cannot be switched off.</p>
            </div>
            
            <!-- Analytics Cookies -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <label for="analytics-cookies" class="text-sm font-serif font-medium text-slate-900">Analytics Cookies</label>
                <input type="checkbox" id="analytics-cookies" class="w-4 h-4 text-amber-600 bg-gray-100 border-gray-300 rounded focus:ring-amber-500">
              </div>
              <p class="text-xs text-slate-600">These cookies help us understand how visitors interact with our website by collecting and reporting information anonymously.</p>
            </div>
            
            <!-- Marketing Cookies -->
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <label for="marketing-cookies" class="text-sm font-serif font-medium text-slate-900">Marketing Cookies</label>
                <input type="checkbox" id="marketing-cookies" class="w-4 h-4 text-amber-600 bg-gray-100 border-gray-300 rounded focus:ring-amber-500">
              </div>
              <p class="text-xs text-slate-600">These cookies are used to track visitors across websites to display relevant and engaging advertisements.</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-3 lg:flex-shrink-0 w-full sm:w-auto">
        <button id="cookie-preferences-btn" class="px-4 py-2.5 text-sm font-serif font-medium text-slate-700 bg-white/70 backdrop-blur-sm border border-white/30 rounded-xl hover:bg-white/80 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl">
          Manage Preferences
        </button>
        <button id="cookie-accept-all" class="px-6 py-2.5 text-sm font-serif font-medium text-white bg-gradient-to-r from-amber-600 to-amber-700 border border-transparent rounded-xl hover:from-amber-700 hover:to-amber-800 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl">
          Accept All
        </button>
        <button id="cookie-accept-essential" class="px-4 py-2.5 text-sm font-serif font-medium text-slate-700 bg-white/70 backdrop-blur-sm border border-white/30 rounded-xl hover:bg-white/80 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl">
          Essential Only
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookie-settings-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
  <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
    <div class="fixed inset-0 bg-black/40 backdrop-blur-sm transition-opacity"></div>
    
    <div class="relative transform overflow-hidden rounded-2xl bg-white/90 backdrop-blur-md border border-white/20 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
      <div class="px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-amber-400/20 to-amber-600/20 backdrop-blur-sm border border-amber-300/30 sm:mx-0 sm:h-10 sm:w-10 shadow-lg">
            <svg class="h-6 w-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/>
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
          </div>
          <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
            <h3 class="text-lg font-serif font-semibold leading-6 text-slate-900 mb-4">Cookie Settings</h3>
            
            <div class="space-y-4">
              <!-- Essential Cookies -->
              <div class="bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl p-4 shadow-lg">
                <div class="flex items-center justify-between mb-2">
                  <label class="text-sm font-serif font-medium text-slate-900">Essential Cookies</label>
                  <div class="flex items-center">
                    <input type="checkbox" id="modal-essential-cookies" checked disabled class="w-4 h-4 text-amber-600 bg-white/70 border-white/50 rounded focus:ring-amber-500/50">
                    <span class="ml-2 text-xs text-slate-500">Always Active</span>
                  </div>
                </div>
                <p class="text-xs text-slate-600">These cookies are necessary for the website to function and cannot be switched off in our systems.</p>
              </div>
              
              <!-- Analytics Cookies -->
              <div class="bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl p-4 shadow-lg">
                <div class="flex items-center justify-between mb-2">
                  <label for="modal-analytics-cookies" class="text-sm font-serif font-medium text-slate-900">Analytics Cookies</label>
                  <input type="checkbox" id="modal-analytics-cookies" class="w-4 h-4 text-amber-600 bg-white/70 border-white/50 rounded focus:ring-amber-500/50">
                </div>
                <p class="text-xs text-slate-600">These cookies allow us to count visits and traffic sources so we can measure and improve the performance of our site.</p>
              </div>
              
              <!-- Marketing Cookies -->
              <div class="bg-white/50 backdrop-blur-sm border border-white/30 rounded-xl p-4 shadow-lg">
                <div class="flex items-center justify-between mb-2">
                  <label for="modal-marketing-cookies" class="text-sm font-serif font-medium text-slate-900">Marketing Cookies</label>
                  <input type="checkbox" id="modal-marketing-cookies" class="w-4 h-4 text-amber-600 bg-white/70 border-white/50 rounded focus:ring-amber-500/50">
                </div>
                <p class="text-xs text-slate-600">These cookies may be set through our site by our advertising partners to build a profile of your interests.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="bg-white/60 backdrop-blur-sm border-t border-white/20 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
        <button id="modal-save-preferences" class="inline-flex w-full justify-center rounded-xl bg-gradient-to-r from-amber-600 to-amber-700 px-3 py-2.5 text-sm font-serif font-semibold text-white shadow-lg hover:from-amber-700 hover:to-amber-800 sm:ml-3 sm:w-auto transition-all duration-200">
          Save Preferences
        </button>
        <button id="modal-accept-all" class="mt-3 inline-flex w-full justify-center rounded-xl bg-white/70 backdrop-blur-sm border border-white/30 px-3 py-2.5 text-sm font-serif font-semibold text-slate-700 shadow-lg hover:bg-white/80 sm:mt-0 sm:w-auto transition-all duration-200">
          Accept All
        </button>
        <button id="modal-cancel" class="mt-3 inline-flex w-full justify-center rounded-xl bg-white/70 backdrop-blur-sm border border-white/30 px-3 py-2.5 text-sm font-serif font-semibold text-slate-700 shadow-lg hover:bg-white/80 sm:mt-0 sm:w-auto sm:ml-3 transition-all duration-200">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Cookie Consent Management
  interface CookiePreferences {
    essential: boolean;
    analytics: boolean;
    marketing: boolean;
    timestamp: string;
  }

  class CookieConsent {
    private banner: HTMLElement | null;
    private modal: HTMLElement | null;
    private cookieName: string;
    private cookieExpiry: number;
    
    constructor() {
      this.banner = document.getElementById('cookie-consent-banner');
      this.modal = document.getElementById('cookie-settings-modal');
      this.cookieName = 'cookie-consent';
      this.cookieExpiry = 365; // days
      
      this.init();
    }
    
    init() {
      // Check if consent already given
      if (!this.hasConsent()) {
        this.showBanner();
      }
      
      this.bindEvents();
      this.loadPreferences();
    }
    
    hasConsent(): boolean {
      return localStorage.getItem(this.cookieName) !== null;
    }
    
    showBanner(): void {
      if (this.banner) {
        this.banner.classList.remove('hidden');
        // Adjust padding based on screen size
        const isMobile = window.innerWidth < 768;
        const paddingBottom = isMobile ? '140px' : '120px';
        document.body.style.paddingBottom = paddingBottom;
      }
    }
    
    hideBanner(): void {
      if (this.banner) {
        this.banner.classList.add('hidden');
        document.body.style.paddingBottom = '0px';
      }
    }
    
    showModal(): void {
      if (this.modal) {
        this.modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }
    
    hideModal(): void {
      if (this.modal) {
        this.modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    }
    
    hideBannerDetails(): void {
      const details = document.getElementById('cookie-details');
      if (details) {
        details.classList.add('hidden');
      }
    }
    
    bindEvents(): void {
      // Banner buttons
      document.getElementById('cookie-accept-all')?.addEventListener('click', () => {
        this.acceptAll();
      });
      
      document.getElementById('cookie-accept-essential')?.addEventListener('click', () => {
        this.acceptEssential();
      });
      
      document.getElementById('cookie-preferences-btn')?.addEventListener('click', () => {
        this.showModal();
      });
      
      // Modal buttons
      document.getElementById('modal-save-preferences')?.addEventListener('click', () => {
        this.savePreferences();
      });
      
      document.getElementById('modal-accept-all')?.addEventListener('click', () => {
        this.acceptAll();
      });
      
      document.getElementById('modal-cancel')?.addEventListener('click', () => {
        this.hideModal();
        this.hideBannerDetails(); // Hide banner details when canceling
      });
      
      // Close modal on backdrop click
      if (this.modal) {
        this.modal.addEventListener('click', (e: Event) => {
          if (e.target === this.modal) {
            this.hideModal();
            this.hideBannerDetails(); // Hide banner details when canceling
          }
        });
      }
      
      // Show modal when Manage Preferences is clicked
      document.getElementById('cookie-preferences-btn')?.addEventListener('click', () => {
        this.showModal();
      });
      
      // Handle window resize for responsive padding
      window.addEventListener('resize', () => {
        if (!this.banner?.classList.contains('hidden')) {
          const isMobile = window.innerWidth < 768;
          const paddingBottom = isMobile ? '140px' : '120px';
          document.body.style.paddingBottom = paddingBottom;
        }
      });
    }
    
    acceptAll(): void {
      const preferences: CookiePreferences = {
        essential: true,
        analytics: true,
        marketing: true,
        timestamp: new Date().toISOString()
      };
      
      this.saveConsent(preferences);
      this.enableAnalytics();
      this.enableMarketing();
      this.hideBanner();
      this.hideModal();
      this.hideBannerDetails(); // Hide banner details
    }
    
    acceptEssential(): void {
      const preferences: CookiePreferences = {
        essential: true,
        analytics: false,
        marketing: false,
        timestamp: new Date().toISOString()
      };
      
      this.saveConsent(preferences);
      this.disableAnalytics();
      this.disableMarketing();
      this.hideBanner();
    }
    
    savePreferences(): void {
      const analyticsElement = document.getElementById('modal-analytics-cookies') as HTMLInputElement;
      const marketingElement = document.getElementById('modal-marketing-cookies') as HTMLInputElement;
      
      const analytics = analyticsElement?.checked || false;
      const marketing = marketingElement?.checked || false;
      
      const preferences: CookiePreferences = {
        essential: true,
        analytics: analytics,
        marketing: marketing,
        timestamp: new Date().toISOString()
      };
      
      this.saveConsent(preferences);
      
      if (analytics) {
        this.enableAnalytics();
      } else {
        this.disableAnalytics();
      }
      
      if (marketing) {
        this.enableMarketing();
      } else {
        this.disableMarketing();
      }
      
      this.hideBanner();
      this.hideModal();
      this.hideBannerDetails(); // Hide banner details
    }
    
    saveConsent(preferences: CookiePreferences): void {
      localStorage.setItem(this.cookieName, JSON.stringify(preferences));
      
      // Also set a cookie for server-side access
      const cookieValue = encodeURIComponent(JSON.stringify(preferences));
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + this.cookieExpiry);
      
      document.cookie = `${this.cookieName}=${cookieValue}; expires=${expiryDate.toUTCString()}; path=/; SameSite=Lax`;
    }
    
    loadPreferences(): void {
      const consent = localStorage.getItem(this.cookieName);
      if (consent) {
        const preferences: CookiePreferences = JSON.parse(consent);
        
        // Update UI to reflect current preferences
        const analyticsElement = document.getElementById('analytics-cookies') as HTMLInputElement;
        const marketingElement = document.getElementById('marketing-cookies') as HTMLInputElement;
        const modalAnalyticsElement = document.getElementById('modal-analytics-cookies') as HTMLInputElement;
        const modalMarketingElement = document.getElementById('modal-marketing-cookies') as HTMLInputElement;
        
        if (analyticsElement) analyticsElement.checked = preferences.analytics;
        if (marketingElement) marketingElement.checked = preferences.marketing;
        if (modalAnalyticsElement) modalAnalyticsElement.checked = preferences.analytics;
        if (modalMarketingElement) modalMarketingElement.checked = preferences.marketing;
        
        // Enable/disable tracking based on preferences
        if (preferences.analytics) {
          this.enableAnalytics();
        }
        if (preferences.marketing) {
          this.enableMarketing();
        }
      }
    }
    
    enableAnalytics(): void {
      // Check if analytics is enabled globally
      if (typeof (window as any).gtag === 'undefined') {
        return; // Analytics not loaded, skip
      }
      
      // Enable Google Analytics
      (window as any).gtag('consent', 'update', {
        'analytics_storage': 'granted'
      });
      
      // Enable other analytics tools here
    }
    
    disableAnalytics(): void {
      // Check if analytics is enabled globally
      if (typeof (window as any).gtag === 'undefined') {
        return; // Analytics not loaded, skip
      }
      
      // Disable Google Analytics
      (window as any).gtag('consent', 'update', {
        'analytics_storage': 'denied'
      });
    }
    
    enableMarketing(): void {
      // Check if analytics is enabled globally
      if (typeof (window as any).gtag === 'undefined') {
        return; // Analytics not loaded, skip
      }
      
      // Enable marketing cookies
      (window as any).gtag('consent', 'update', {
        'ad_storage': 'granted',
        'ad_user_data': 'granted',
        'ad_personalization': 'granted'
      });
    }
    
    disableMarketing(): void {
      // Check if analytics is enabled globally
      if (typeof (window as any).gtag === 'undefined') {
        return; // Analytics not loaded, skip
      }
      
      // Disable marketing cookies
      (window as any).gtag('consent', 'update', {
        'ad_storage': 'denied',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied'
      });
    }
  }
  
  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new CookieConsent();
  });
</script>

<style>
  .cookie-banner {
    animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  
  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .cookie-banner.hidden {
    animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes slideDown {
    from {
      transform: translateY(0);
      opacity: 1;
    }
    to {
      transform: translateY(100%);
      opacity: 0;
    }
  }
  
  /* Glassmorphism effects */
  .cookie-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    border-radius: inherit;
    pointer-events: none;
  }
  
  /* Enhanced mobile responsiveness */
  @media (max-width: 640px) {
    .cookie-banner {
      padding: 1rem;
      margin: 0;
    }
    
    .cookie-banner .flex-col {
      gap: 1rem;
    }
    
    .cookie-banner .w-full {
      width: 100%;
    }
    
    /* Ensure buttons stack properly on mobile */
    .cookie-banner .flex-col.sm\\:flex-row {
      flex-direction: column;
    }
    
    /* Better spacing for mobile */
    .cookie-banner .gap-3 {
      gap: 0.75rem;
    }
    
    /* Modal adjustments for mobile */
    #cookie-settings-modal .sm\\:my-8 {
      margin: 1rem 0;
    }
    
    #cookie-settings-modal .sm\\:max-w-lg {
      max-width: calc(100vw - 2rem);
    }
  }
  
  /* iPad specific adjustments */
  @media (min-width: 641px) and (max-width: 1024px) {
    .cookie-banner {
      padding: 1.5rem;
    }
    
    .cookie-banner .lg\\:flex-row {
      flex-direction: row;
      align-items: center;
    }
    
    .cookie-banner .lg\\:flex-shrink-0 {
      flex-shrink: 0;
    }
  }
  
  /* Enhanced glassmorphism for better browser support */
  @supports not (backdrop-filter: blur(12px)) {
    .cookie-banner {
      background: rgba(255, 255, 255, 0.95);
    }
    
    .cookie-banner .backdrop-blur-md {
      background: rgba(255, 255, 255, 0.9);
    }
  }
  
  /* Improved focus states for accessibility */
  .cookie-banner button:focus {
    outline: 2px solid rgba(212, 175, 55, 0.5);
    outline-offset: 2px;
  }
  
  /* Smooth transitions for all interactive elements */
  .cookie-banner button,
  .cookie-banner input,
  .cookie-banner a {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Enhanced shadow effects */
  .cookie-banner .shadow-lg {
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }
  
  .cookie-banner .shadow-xl {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
</style>
